/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(e,a){var n=function(t){for(var a=e.length-1;a>=0;--a)if(e[a].id==t)return a},l=function(e){return t("<div/>").text(e).html()},s=function(e){var a=t('<a href="#" class="'+i.listItemClass+' clearfix" data-id="'+e.id+'">'+l(e.name)+"</a>");return i.removable&&a.append('<button data-role="remove" class="'+i.removeButtonClass+'">'+i.removeButtonHtml+"</button>"),a},d=function(a){if(o.find("ul").length<i.maxLevels){var n=t('<div class="'+i.columnClass+'">');i.addable&&n.append('<form data-parent="'+a+'"><div class="form-group"><button data-role="add" class="'+i.addButtonClass+'">'+i.addButtonHtml+"</button></div></form>"),n.append('<ul class="'+i.selectClass+'"></ul>');for(var l=e.length,d=0;l>d;d++){var r=e[d];(null===a&&!r.hasOwnProperty("parent")||r.parent==a)&&n.children("ul").append(s(r))}return o.append(n)}},i=t.extend({selectClass:"list-group",columnClass:"col-md-4",activeClass:"active",listItemClass:"list-group-item",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-xs btn-danger pull-right",removeButtonHtml:"X",addInputClass:"form-control",addInputPlaceholder:"Category name",removable:!1,maxLevels:3,onAdd:function(){},onRemove:function(){},onSelect:function(){}},a),o=this;return d(),o.on("click","a[data-id]",function(a){a.preventDefault(),t(this).siblings().removeClass(i.activeClass),t(this).addClass(i.activeClass);var l=t(this).data("id"),s=n(l);t(this).parent().parent().nextAll().remove(),d(l),i.onSelect(e[s],s)}),o.on("submit","form",function(a){if(a.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input data-role="add" type="text" placeholder="'+i.addInputPlaceholder+'" class="'+i.addInputClass+'">'),t(this).children("input[data-role=add]").focus(),t(this).find("button[data-role=add]").css("display","none");else{var n=t(this).find("input[data-role=add]").val();if(null!==n&&""!==n.trim()){for(var l={id:0,name:n},d=t(this).data("parent"),o=t(this).siblings("ul"),r=e.length-1;r>=0;--r)e[r].id>=l.id&&(l.id=e[r].id+1);"undefined"!==d&&(l.parent=d),o.append(s(l)),e.push(l),t(this).children("input[data-role=add]").remove(),t(this).find("button[data-role=add]").css("display","inline-block"),i.onAdd(l,e.length-1)}}}),o.on("blur","input[data-role=add]",function(){""===t(this).val().trim()&&(t(this).siblings().children("button[data-role=add]").css("display","inline-block"),t(this).remove())}),o.on("click","button[data-role=remove]",function(a){a.stopPropagation(),a.preventDefault();var l=t(this).parent().data("id"),s=n(l),d=e[s];t(this).closest("."+i.columnClass).nextAll().remove(),t(this).parent().remove(),e.splice(s,1);for(var o=e.length-1;o>=0;--o)e[o].parent==l&&e.splice(o,1);i.onRemove(d,s)}),o}}(jQuery);
