/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(a,e){var n=function(t){for(var e=a.length;e--;)if(a[e].id==t)return e},s=function(a){return t("<div/>").text(a).html()},l=function(t){var a='<a href="#" class="'+o.listItemClass+' clearfix" data-id="'+t.id+'"><span>'+s(t.name)+"</span>",e='<div class="btn-group pull-right">';return o.removable&&(e+='<button data-role="remove" class="'+o.removeButtonClass+'">'+o.removeButtonHtml+"</button>"),e+="</div>",a+e+"</a>"},d=function(t){if(i.find("ul").length<o.maxColumns){var e='<div class="'+o.columnClass+'">';o.addable&&(e+='<form data-parent="'+t+'"><div class="form-group"><button data-role="add" class="'+o.addButtonClass+'">'+o.addButtonHtml+"</button></div></form>"),e+='<ul class="'+o.selectClass+'">';for(var n=a.length,s=0;n>s;s++){var d=a[s];(null===t&&void 0===d.parent||d.parent==t)&&(e+=l(d))}return i.append(e+"</ul></div>")}},o=t.extend({selectClass:"list-group",columnClass:"col-sm-4",activeClass:"active",listItemClass:"list-group-item",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-sm btn-danger",removeButtonHtml:"&times;",addInputClass:"form-control",addInputPlaceholder:"Category name",addable:!1,removable:!1,maxColumns:3,onAdd:function(){},onRemove:function(){},onSelect:function(){}},e),i=this;return d(),i.on("click","a[data-id]",function(e){e.preventDefault(),t(this).siblings().removeClass(o.activeClass),t(this).addClass(o.activeClass);var s=t(this).data("id"),l=n(s);t(this).closest("."+o.columnClass).nextAll().remove(),d(s),o.onSelect(a[l])}),i.on("submit","form",function(e){if(e.preventDefault(),0===t(this).find("input[data-role=add]").length)t(this).prepend('<input data-role="add" type="text" placeholder="'+o.addInputPlaceholder+'" class="'+o.addInputClass+'">'),t(this).find("input[data-role=add]").focus(),t(this).find("button[data-role=add]").hide();else{var n=t(this).find("input[data-role=add]").val();if(null!==n){for(var s={id:0,name:n},d=t(this).data("parent"),i=a.length-1;i>=0;--i)a[i].id>=s.id&&(s.id=a[i].id+1);"undefined"!==d&&(s.parent=d),t(this).find("input[data-role=add]").blur(),t(this).find("button[data-role=add]").show(),o.onAdd(s)!==!1&&(t(this).siblings("ul").append(l(s)),a.push(s))}}}),i.on("blur","input[data-role=add]",function(){t(this).siblings().find("button[data-role=add]").show(),t(this).remove()}),i.on("click","button[data-role=remove]",function(e){e.stopPropagation(),e.preventDefault();var s=t(this).closest("[data-id]").data("id"),l=n(s),d=a[l];o.onRemove(d)!==!1&&(t(this).closest("."+o.columnClass).nextAll().remove(),t(this).closest("[data-id]").remove(),a.splice(l,1))}),i}}(jQuery);
