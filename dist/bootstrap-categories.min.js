/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(a,n){var e=function(t){for(var n=a.length;n--;)if(a[n].id==t)return n},l=function(a){return t("<div/>").text(a).html()},d=function(a){var n=t('<a href="#" class="'+o.listItemClass+' clearfix" data-id="'+a.id+'"><span>'+l(a.name)+"</span></a>"),e=t('<div class="btn-group pull-right"></div>').appendTo(n);return o.removable&&e.append('<button data-role="remove" class="'+o.removeButtonClass+'">'+o.removeButtonHtml+"</button>"),n},s=function(n){if(i.find("ul").length<o.maxColumns){var e=t('<div class="'+o.columnClass+'">');o.addable&&e.append('<form data-parent="'+n+'"><div class="form-group"><button data-role="add" class="'+o.addButtonClass+'">'+o.addButtonHtml+"</button></div></form>"),e.append('<ul class="'+o.selectClass+'"></ul>');for(var l=a.length,s=0;l>s;s++){var r=a[s];(null===n&&void 0===r.parent||r.parent==n)&&e.children("ul").append(d(r))}return i.append(e)}},o=t.extend({selectClass:"list-group",columnClass:"col-sm-4",activeClass:"active",listItemClass:"list-group-item",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-sm btn-danger",removeButtonHtml:"&times;",addInputClass:"form-control",addInputPlaceholder:"Category name",addable:!1,removable:!1,maxColumns:3,onAdd:function(){},onRemove:function(){},onSelect:function(){}},n),i=this;return s(),i.on("click","a[data-id]",function(n){n.preventDefault(),t(this).siblings().removeClass(o.activeClass),t(this).addClass(o.activeClass);var l=t(this).data("id"),d=e(l);t(this).parent().parent().nextAll().remove(),s(l),o.onSelect(a[d])}),i.on("submit","form",function(n){if(n.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input data-role="add" type="text" placeholder="'+o.addInputPlaceholder+'" class="'+o.addInputClass+'">'),t(this).children("input[data-role=add]").focus(),t(this).find("button[data-role=add]").hide();else{var e=t(this).find("input[data-role=add]").val();if(null!==e&&""!==e.trim()){for(var l={id:0,name:e},s=t(this).data("parent"),i=t(this).siblings("ul"),r=a.length-1;r>=0;--r)a[r].id>=l.id&&(l.id=a[r].id+1);"undefined"!==s&&(l.parent=s),t(this).children("input[data-role=add]").remove(),t(this).find("button[data-role=add]").show(),o.onAdd(l)!==!1&&(i.append(d(l)),a.push(l))}}}),i.on("click","a[data-id] button,input",function(t){t.stopPropagation(),t.preventDefault()}),i.on("blur","input[data-role=add]",function(){t(this).siblings().children("button[data-role=add]").show(),t(this).remove()}),i.on("click","button[data-role=remove]",function(){var n=t(this).parent().parent().data("id"),l=e(n),d=a[l];o.onRemove(d)!==!1&&(t(this).closest("."+o.columnClass).nextAll().remove(),t(this).parent().parent().remove(),a.splice(l,1))}),i}}(jQuery);
