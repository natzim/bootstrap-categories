/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(n,e){var a=function(t){for(var e=n.length-1;e>=0;--e)if(n[e].id==t)return e},l=function(n){var e=t('<li class="list-group-item clearfix" data-id="'+n.id+'">'+n.name+"</li>");return s.removable&&e.append('<button data-role="remove" class="btn btn-sm btn-danger pull-right">X</button>'),e},i=function(e){var a=t('<div class="'+s.columnClass+'">');s.addable&&o.find("ul").length<s.maxLevels&&a.append('<form data-parent="'+e+'"><div class="form-group"><button class="'+s.addButtonClass+'">'+s.addButtonHtml+"</button></div></form>"),a.append('<ul class="'+s.selectClass+'"></ul>');for(var i=n.length,r=0;i>r;r++){var d=n[r];(null===e&&!d.hasOwnProperty("parent")||d.parent==e)&&a.children("ul").append(l(d))}return o.append(a)},s=t.extend({selectClass:"list-group",columnClass:"col-md-4",addButtonClass:"btn btn-success",addButtonHtml:"+",addInputClass:"form-control",addInputPlaceholder:"Category name",removable:!1,maxLevels:3,onCategoryAdd:function(){},onCategoryRemove:function(){},onSelectChange:function(){}},e),o=this;return i(),o.on("click","li",function(e){e.preventDefault(),t(this).siblings().removeClass("active"),t(this).addClass("active");var l=t(this).data("id"),o=a(l);t(this).parent().parent().nextAll().remove(),i(l),s.onSelectChange(n[o],o)}),o.on("submit","form",function(e){if(e.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input type="text" placeholder="'+s.addInputPlaceholder+'" class="'+s.addInputClass+'">'),t(this).children("input").focus(),t(this).find("button").css("display","none");else{var a=t(this).find("input").val();if(null!==a&&""!==a.trim()){for(var i={id:0,name:a},o=t(this).data("parent"),r=t(this).siblings("ul"),d=n.length-1;d>=0;--d)n[d].id>=i.id&&(i.id=n[d].id+1);"undefined"!==o&&(i.parent=o),r.append(l(i)),n.push(i),t(this).children("input").remove(),t(this).find("button").css("display","inline-block"),s.onCategoryAdd(i,n.length-1)}}}),o.on("click","button[data-role=remove]",function(e){e.stopPropagation();var l=t(this).parent().data("id"),i=a(l),o=n[i];t(this).closest("."+s.columnClass).nextAll().remove(),t(this).parent().remove(),n.splice(i,1),s.onCategoryRemove(o,i)}),o}}(jQuery);
