/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(e,n){var a=function(t){for(var n=e.length-1;n>=0;--n)if(e[n].id==t)return n},l=function(e){var n=t('<li class="list-group-item clearfix" data-id="'+e.id+'">'+e.name+"</li>");return o.removable&&n.append('<button data-role="remove" class="'+o.removeButtonClass+'">'+o.removeButtonHtml+"</button>"),n},s=function(n){var a=t('<div class="'+o.columnClass+'">');o.addable&&i.find("ul").length<o.maxLevels&&a.append('<form data-parent="'+n+'"><div class="form-group"><button class="'+o.addButtonClass+'">'+o.addButtonHtml+"</button></div></form>"),a.append('<ul class="'+o.selectClass+'"></ul>');for(var s=e.length,r=0;s>r;r++){var d=e[r];(null===n&&!d.hasOwnProperty("parent")||d.parent==n)&&a.children("ul").append(l(d))}return i.append(a)},o=t.extend({selectClass:"list-group",columnClass:"col-md-4",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-xs btn-danger pull-right",removeButtonHtml:"X",addInputClass:"form-control",addInputPlaceholder:"Category name",removable:!1,maxLevels:3,onCategoryAdd:function(){},onCategoryRemove:function(){},onSelectChange:function(){}},n),i=this;return s(),i.on("click","li",function(n){n.preventDefault(),t(this).siblings().removeClass("active"),t(this).addClass("active");var l=t(this).data("id"),i=a(l);t(this).parent().parent().nextAll().remove(),s(l),o.onSelectChange(e[i],i)}),i.on("submit","form",function(n){if(n.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input type="text" placeholder="'+o.addInputPlaceholder+'" class="'+o.addInputClass+'">'),t(this).children("input").focus(),t(this).find("button").css("display","none");else{var a=t(this).find("input").val();if(null!==a&&""!==a.trim()){for(var s={id:0,name:a},i=t(this).data("parent"),r=t(this).siblings("ul"),d=e.length-1;d>=0;--d)e[d].id>=s.id&&(s.id=e[d].id+1);"undefined"!==i&&(s.parent=i),r.append(l(s)),e.push(s),t(this).children("input").remove(),t(this).find("button").css("display","inline-block"),o.onCategoryAdd(s,e.length-1)}}}),i.on("click","button[data-role=remove]",function(n){n.stopPropagation();var l=t(this).parent().data("id"),s=a(l),i=e[s];t(this).closest("."+o.columnClass).nextAll().remove(),t(this).parent().remove(),e.splice(s,1),o.onCategoryRemove(i,s)}),i}}(jQuery);
