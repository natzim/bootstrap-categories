/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(e,n){var a=function(t){for(var n=e.length-1;n>=0;--n)if(e[n].id==t)return n},l=function(e){return t("<div/>").text(e).html()},s=function(e){var n=t('<li class="list-group-item clearfix" data-id="'+e.id+'">'+l(e.name)+"</li>");return d.removable&&n.append('<button data-role="remove" class="'+d.removeButtonClass+'">'+d.removeButtonHtml+"</button>"),n},o=function(n){if(i.find("ul").length<d.maxLevels){var a=t('<div class="'+d.columnClass+'">');d.addable&&a.append('<form data-parent="'+n+'"><div class="form-group"><button data-role="add" class="'+d.addButtonClass+'">'+d.addButtonHtml+"</button></div></form>"),a.append('<ul class="'+d.selectClass+'"></ul>');for(var l=e.length,o=0;l>o;o++){var r=e[o];(null===n&&!r.hasOwnProperty("parent")||r.parent==n)&&a.children("ul").append(s(r))}return i.append(a)}},d=t.extend({selectClass:"list-group",columnClass:"col-md-4",activeClass:"active",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-xs btn-danger pull-right",removeButtonHtml:"X",addInputClass:"form-control",addInputPlaceholder:"Category name",removable:!1,maxLevels:3,onAdd:function(){},onRemove:function(){},onSelect:function(){}},n),i=this;return o(),i.on("click","li",function(n){n.preventDefault(),t(this).siblings().removeClass(d.activeClass),t(this).addClass(d.activeClass);var l=t(this).data("id"),s=a(l);t(this).parent().parent().nextAll().remove(),o(l),d.onSelect(e[s],s)}),i.on("submit","form",function(n){if(n.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input data-role="add" type="text" placeholder="'+d.addInputPlaceholder+'" class="'+d.addInputClass+'">'),t(this).children("input[data-role=add]").focus(),t(this).find("button[data-role=add]").css("display","none");else{var a=t(this).find("input[data-role=add]").val();if(null!==a&&""!==a.trim()){for(var l={id:0,name:a},o=t(this).data("parent"),i=t(this).siblings("ul"),r=e.length-1;r>=0;--r)e[r].id>=l.id&&(l.id=e[r].id+1);"undefined"!==o&&(l.parent=o),i.append(s(l)),e.push(l),t(this).children("input[data-role=add]").remove(),t(this).find("button[data-role=add]").css("display","inline-block"),d.onAdd(l,e.length-1)}}}),i.on("click","button[data-role=remove]",function(n){n.stopPropagation();var l=t(this).parent().data("id"),s=a(l),o=e[s];t(this).closest("."+d.columnClass).nextAll().remove(),t(this).parent().remove(),e.splice(s,1);for(var i=e.length-1;i>=0;--i)e[i].parent==l&&e.splice(i,1);console.log(e),d.onRemove(o,s)}),i}}(jQuery);
