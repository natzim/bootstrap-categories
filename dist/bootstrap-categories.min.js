/*
 * Bootstrap Categories
 *
 * @author Nat Zimmermann <nat@natzim.me>
 * @license MIT
 */
!function(t){t.fn.categories=function(a,e){var n=function(t){for(var e=a.length-1;e>=0;--e)if(a[e].id==t)return e},l=function(a){return t("<div/>").text(a).html()},s=function(a){var e=t('<a href="#" class="'+d.listItemClass+' clearfix" data-id="'+a.id+'"><span>'+l(a.name)+"</span></a>"),n=t('<div class="btn-group pull-right"></div>').appendTo(e);return d.removable&&n.append('<button data-role="remove" class="'+d.removeButtonClass+'">'+d.removeButtonHtml+"</button>"),e},i=function(e){if(o.find("ul").length<d.maxLevels){var n=t('<div class="'+d.columnClass+'">');d.addable&&n.append('<form data-parent="'+e+'"><div class="form-group"><button data-role="add" class="'+d.addButtonClass+'">'+d.addButtonHtml+"</button></div></form>"),n.append('<ul class="'+d.selectClass+'"></ul>');for(var l=a.length,i=0;l>i;i++){var r=a[i];(null===e&&!r.hasOwnProperty("parent")||r.parent==e)&&n.children("ul").append(s(r))}return o.append(n)}},d=t.extend({selectClass:"list-group",columnClass:"col-sm-4",activeClass:"active",listItemClass:"list-group-item",addButtonClass:"btn btn-success",addButtonHtml:"+",removeButtonClass:"btn btn-sm btn-danger",removeButtonHtml:"X",addInputClass:"form-control",addInputPlaceholder:"Category name",addable:!1,removable:!1,maxLevels:3,onAdd:function(){},onRemove:function(){},onSelect:function(){}},e),o=this;return i(),o.on("click","a[data-id]",function(e){e.preventDefault(),t(this).siblings().removeClass(d.activeClass),t(this).addClass(d.activeClass);var l=t(this).data("id"),s=n(l);t(this).parent().parent().nextAll().remove(),i(l),d.onSelect(a[s])}),o.on("submit","form",function(e){if(e.preventDefault(),0===t(this).children("input").length)t(this).prepend('<input data-role="add" type="text" placeholder="'+d.addInputPlaceholder+'" class="'+d.addInputClass+'">'),t(this).children("input[data-role=add]").focus(),t(this).find("button[data-role=add]").css("display","none");else{var n=t(this).find("input[data-role=add]").val();if(null!==n&&""!==n.trim()){for(var l={id:0,name:n},i=t(this).data("parent"),o=t(this).siblings("ul"),r=a.length-1;r>=0;--r)a[r].id>=l.id&&(l.id=a[r].id+1);"undefined"!==i&&(l.parent=i),t(this).children("input[data-role=add]").remove(),t(this).find("button[data-role=add]").css("display","inline-block"),d.onAdd(l)!==!1&&(o.append(s(l)),a.push(l))}}}),o.on("click","a[data-id] button,input",function(t){t.stopPropagation(),t.preventDefault()}),o.on("blur","input[data-role=add]",function(){""===t(this).val().trim()&&(t(this).siblings().children("button[data-role=add]").css("display","inline-block"),t(this).remove())}),o.on("click","button[data-role=remove]",function(){var e=t(this).parent().parent().data("id"),l=n(e),s=a[l];if(d.onRemove(s)!==!1){t(this).closest("."+d.columnClass).nextAll().remove(),t(this).parent().parent().remove(),a.splice(l,1);for(var i=a.length-1;i>=0;--i)a[i].parent==e&&a.splice(i,1)}}),o}}(jQuery);
